<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Pop Math Quest ‚≠ê</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --pink: #FF6B9D;
            --hot-pink: #FF1493;
            --purple: #C471ED;
            --blue: #12C2E9;
            --yellow: #F7D94C;
            --mint: #7FDBCA;
            --coral: #FF7F7F;
            --bts-purple: #8B00FF;
            --blackpink-pink: #FF007F;
        }
        
        body {
            font-family: 'Poppins', 'Nunito', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated gradient background */
        .bg-gradient {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #1a0533, #2d1b4e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: 0;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating hearts and stars */
        .floating-elements {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }
        .floating {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 8s linear infinite;
            opacity: 0.6;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        /* Sparkle effect */
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: sparkle 2s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1); opacity: 1; }
        }
        
        /* Stars background */
        .stars {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 1;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }
        
        .container {
            position: relative;
            z-index: 10;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header with animated text */
        .header {
            text-align: center;
            padding: 30px 0;
        }
        .header h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #FF6B9D, #FF1493, #C471ED, #12C2E9, #FF6B9D);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowText 5s ease infinite, bounce 2s ease-in-out infinite;
            text-shadow: 0 0 50px rgba(255, 107, 157, 0.5);
        }
        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .header p {
            color: #E8D5F2;
            font-size: 1.3rem;
            margin-top: 10px;
            animation: fadeInUp 1s ease-out;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Glowing border animation */
        @keyframes glowBorder {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 157, 0.5), 0 0 40px rgba(196, 113, 237, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 107, 157, 0.8), 0 0 60px rgba(196, 113, 237, 0.5); }
        }
        
        /* Score Bar */
        .score-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 30px;
            border: 2px solid rgba(255,255,255,0.2);
            animation: glowBorder 3s ease-in-out infinite;
        }
        .score-item {
            text-align: center;
        }
        .score-label {
            color: #B8A9C9;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }
        .score-value {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--yellow), #FF9500, var(--coral));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Artist Card with photo */
        .artist-card {
            background: linear-gradient(135deg, rgba(255,20,147,0.2), rgba(139,0,255,0.2), rgba(18,194,233,0.2));
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            gap: 25px;
            animation: slideInLeft 0.6s ease-out, glowBorder 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .artist-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        .artist-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.5);
            animation: photoGlow 2s ease-in-out infinite alternate;
            flex-shrink: 0;
        }
        @keyframes photoGlow {
            from { box-shadow: 0 0 20px rgba(255, 20, 147, 0.5), 0 0 40px rgba(139, 0, 255, 0.3); }
            to { box-shadow: 0 0 30px rgba(255, 20, 147, 0.8), 0 0 60px rgba(139, 0, 255, 0.5); }
        }
        
        .artist-info {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        .artist-info h3 {
            color: white;
            font-size: 1.6rem;
            font-weight: 800;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }
        .artist-info p {
            color: #D4C5E8;
            font-size: 1rem;
            margin-top: 5px;
            line-height: 1.5;
        }
        .artist-badge {
            background: linear-gradient(135deg, var(--mint), var(--blue));
            padding: 6px 18px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 700;
            color: #1a1a2e;
            display: inline-block;
            margin-top: 10px;
            animation: badgePop 0.5s ease-out;
        }
        @keyframes badgePop {
            0% { transform: scale(0); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .group-logo {
            font-size: 2rem;
            margin-left: auto;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Question Card */
        .question-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 35px;
            margin-bottom: 25px;
            border: 2px solid rgba(255,255,255,0.15);
            animation: fadeInUp 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }
        .question-card::after {
            content: '‚ú®';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 1.5rem;
            animation: spin 4s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .question-type {
            display: inline-block;
            background: linear-gradient(135deg, var(--purple), var(--hot-pink));
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            animation: slideInRight 0.4s ease-out;
            box-shadow: 0 5px 20px rgba(196, 113, 237, 0.4);
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .question-text {
            color: white;
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1.7;
            margin-bottom: 25px;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .question-visual {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        /* Visual elements with animations */
        .grid-visual {
            display: grid;
            gap: 4px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .grid-cell {
            width: 35px;
            height: 35px;
            background: rgba(255,255,255,0.15);
            border-radius: 6px;
            transition: all 0.3s;
            animation: cellPop 0.5s ease-out backwards;
        }
        .grid-cell.filled {
            background: linear-gradient(135deg, var(--pink), var(--purple));
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.6);
        }
        @keyframes cellPop {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .shape-visual {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 16px;
        }
        .rectangle {
            border: 5px solid var(--mint);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: rgba(127, 219, 202, 0.1);
            animation: rectGlow 2s ease-in-out infinite;
        }
        @keyframes rectGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(127, 219, 202, 0.3); }
            50% { box-shadow: 0 0 25px rgba(127, 219, 202, 0.6); }
        }
        .dimension {
            position: absolute;
            color: var(--yellow);
            font-weight: 800;
            font-size: 1.1rem;
            text-shadow: 0 0 10px rgba(247, 217, 76, 0.5);
        }
        .dimension.width { bottom: -30px; }
        .dimension.height { right: -45px; }
        
        .fraction-visual {
            display: flex;
            gap: 8px;
        }
        .fraction-piece {
            width: 55px;
            height: 55px;
            border-radius: 12px;
            border: 3px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            animation: piecePop 0.4s ease-out backwards;
        }
        .fraction-piece.filled {
            background: linear-gradient(135deg, var(--coral), var(--yellow));
            box-shadow: 0 0 20px rgba(255, 127, 127, 0.5);
        }
        @keyframes piecePop {
            from { transform: scale(0) rotate(-180deg); }
            to { transform: scale(1) rotate(0deg); }
        }
        
        /* Answer Buttons with hover effects */
        .answers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .answer-btn {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 22px;
            color: white;
            font-size: 1.5rem;
            font-weight: 800;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .answer-btn:hover::before {
            left: 100%;
        }
        .answer-btn:hover {
            background: linear-gradient(135deg, rgba(255,107,157,0.3), rgba(196,113,237,0.3));
            border-color: var(--pink);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4);
        }
        .answer-btn.correct {
            background: linear-gradient(135deg, #00D26A, #00A651);
            border-color: #00D26A;
            animation: correctPop 0.6s ease-out;
        }
        @keyframes correctPop {
            0% { transform: scale(1); }
            30% { transform: scale(1.1); }
            60% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        .answer-btn.wrong {
            background: linear-gradient(135deg, #FF4757, #C44569);
            border-color: #FF4757;
            animation: wrongShake 0.5s ease-out;
        }
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-15px); }
            40% { transform: translateX(15px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }
        
        /* Feedback with confetti effect */
        .feedback {
            text-align: center;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }
        
        /* Screens */
        .screen {
            text-align: center;
            padding: 40px 20px;
        }
        .screen.hidden { display: none; }
        
        /* Topic selection grid */
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px auto;
            max-width: 600px;
        }
        .topic-btn {
            background: rgba(255,255,255,0.08);
            border: 3px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 20px 15px;
            color: white;
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }
        .topic-btn:hover {
            transform: translateY(-3px);
            border-color: var(--pink);
        }
        .topic-btn.selected {
            background: linear-gradient(135deg, var(--pink), var(--purple));
            border-color: var(--pink);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }
        .topic-btn .emoji {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 10px;
            animation: topicBounce 2s ease-in-out infinite;
        }
        @keyframes topicBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Start button */
        .start-btn {
            background: linear-gradient(135deg, var(--hot-pink), var(--purple), var(--blue));
            background-size: 200% 200%;
            border: none;
            border-radius: 35px;
            padding: 20px 60px;
            color: white;
            font-size: 1.4rem;
            font-weight: 800;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 15px 40px rgba(255, 20, 147, 0.4);
            margin-top: 25px;
            animation: gradientBG 3s ease infinite, buttonPulse 2s ease-in-out infinite;
        }
        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 15px 40px rgba(255, 20, 147, 0.4); }
            50% { box-shadow: 0 20px 50px rgba(255, 20, 147, 0.6); }
        }
        .start-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 60px rgba(255, 20, 147, 0.6);
        }
        
        /* K-pop group photos slider */
        .kpop-slider {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .kpop-thumb {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
            cursor: pointer;
            animation: thumbPop 0.5s ease-out backwards;
        }
        .kpop-thumb:hover {
            transform: scale(1.2);
            border-color: var(--pink);
            box-shadow: 0 0 25px rgba(255, 107, 157, 0.6);
        }
        
        /* End Screen */
        .final-score {
            font-size: 6rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--yellow), #FF9500, var(--coral), var(--pink));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowText 3s ease infinite;
        }
        .final-message {
            color: #E8D5F2;
            font-size: 1.4rem;
            margin: 25px 0;
        }
        .achievements {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 35px 0;
        }
        .achievement {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
            padding: 20px 25px;
            border-radius: 20px;
            border: 2px solid rgba(255,215,0,0.3);
            animation: achievePop 0.5s ease-out backwards;
        }
        @keyframes achievePop {
            from { transform: scale(0) rotate(-20deg); }
            to { transform: scale(1) rotate(0deg); }
        }
        .achievement .emoji { font-size: 2.5rem; }
        .achievement .label { color: #E8D5F2; font-size: 0.95rem; font-weight: 600; }
        
        /* Confetti */
        .confetti {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 100;
        }
        .confetti-piece {
            position: absolute;
            width: 15px;
            height: 15px;
            top: -20px;
            animation: confettiFall 4s linear forwards;
        }
        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Lightstick cursor trail effect area */
        .lightstick-trail {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 1.5rem;
            transition: all 0.1s;
        }

        /* Mobile responsive */
        @media (max-width: 700px) {
            .header h1 { font-size: 2.2rem; }
            .artist-card { flex-direction: column; text-align: center; }
            .answers { grid-template-columns: 1fr; }
            .topic-grid { grid-template-columns: repeat(2, 1fr); }
            .artist-photo { width: 100px; height: 100px; }
            .kpop-slider { gap: 10px; }
            .kpop-thumb { width: 60px; height: 60px; }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="stars" id="stars"></div>
    <div class="floating-elements" id="floating"></div>
    <div class="confetti" id="confetti"></div>
    
    <div class="container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen">
            <div class="header">
                <h1>‚ú® K-Pop Math Quest ‚ú®</h1>
                <p>Learn math with your favorite K-pop stars! üíú</p>
            </div>
            
            <div class="kpop-slider">
                <img src="https://i.pinimg.com/originals/5b/2e/0b/5b2e0b8f7a3f8e9b4c1d3e5f7a9b2c4d.jpg" class="kpop-thumb" alt="K-pop" onerror="this.src='https://via.placeholder.com/80/FF6B9D/fff?text=BTS'">
                <img src="https://i.pinimg.com/564x/bp/1.jpg" class="kpop-thumb" alt="K-pop" onerror="this.src='https://via.placeholder.com/80/000/FF69B4?text=BP'">
                <img src="https://i.pinimg.com/564x/nj/1.jpg" class="kpop-thumb" alt="K-pop" onerror="this.src='https://via.placeholder.com/80/87CEEB/fff?text=NJ'">
                <img src="https://i.pinimg.com/564x/sk/1.jpg" class="kpop-thumb" alt="K-pop" onerror="this.src='https://via.placeholder.com/80/000/fff?text=SKZ'">
                <img src="https://i.pinimg.com/564x/tw/1.jpg" class="kpop-thumb" alt="K-pop" onerror="this.src='https://via.placeholder.com/80/FF9500/fff?text=TWICE'">
            </div>
            
            <div class="artist-card">
                <img src="https://via.placeholder.com/120/8B00FF/fff?text=üíú" class="artist-photo" alt="Welcome">
                <div class="artist-info">
                    <h3>Welcome, ARMY! üíú‚ú®</h3>
                    <p>Practice fractions, multiplication, division, area & perimeter with BTS, BLACKPINK, NewJeans, Stray Kids, TWICE and more!</p>
                    <span class="artist-badge">üá®üá¶ Grade 4 Ontario Curriculum</span>
                </div>
                <span class="group-logo">üé§</span>
            </div>
            
            <h3 style="color: white; margin-bottom: 15px; font-size: 1.3rem;">üéØ Choose Your Topics:</h3>
            <div class="topic-grid">
                <button class="topic-btn selected" data-topic="fractions">
                    <span class="emoji">üçï</span>
                    Fractions
                </button>
                <button class="topic-btn selected" data-topic="multiplication">
                    <span class="emoji">‚úñÔ∏è</span>
                    Multiply
                </button>
                <button class="topic-btn selected" data-topic="division">
                    <span class="emoji">‚ûó</span>
                    Division
                </button>
                <button class="topic-btn selected" data-topic="area">
                    <span class="emoji">‚¨õ</span>
                    Area
                </button>
                <button class="topic-btn selected" data-topic="perimeter">
                    <span class="emoji">üìè</span>
                    Perimeter
                </button>
                <button class="topic-btn selected" data-topic="mixed">
                    <span class="emoji">üéØ</span>
                    Mixed!
                </button>
            </div>
            
            <button class="start-btn" onclick="startGame()">üöÄ Start Concert! üé§</button>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
            <div class="score-bar">
                <div class="score-item">
                    <div class="score-label">‚≠ê Score</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">üéµ Song</div>
                    <div class="score-value"><span id="current">1</span>/10</div>
                </div>
                <div class="score-item">
                    <div class="score-label">üî• Streak</div>
                    <div class="score-value" id="streak">0</div>
                </div>
            </div>
            
            <div class="artist-card" id="artist-card">
                <img id="artist-photo" src="" class="artist-photo" alt="K-pop Star">
                <div class="artist-info">
                    <h3 id="artist-name">BTS</h3>
                    <p id="artist-hint">Hint will appear here...</p>
                    <span class="artist-badge" id="question-topic">Multiplication</span>
                </div>
                <span class="group-logo" id="group-emoji">üíú</span>
            </div>
            
            <div class="question-card">
                <div class="question-type" id="question-type">Multiplication</div>
                <div class="question-text" id="question-text">Loading question...</div>
                <div class="question-visual" id="question-visual"></div>
                <div class="answers" id="answers"></div>
            </div>
            
            <div class="feedback" id="feedback"></div>
        </div>
        
        <!-- End Screen -->
        <div id="end-screen" class="screen hidden">
            <div class="header">
                <h1>üéâ Concert Complete! üéâ</h1>
            </div>
            
            <div class="final-score" id="final-score">0</div>
            <div class="final-message" id="final-message">Amazing performance!</div>
            
            <div class="achievements" id="achievements"></div>
            
            <button class="start-btn" onclick="location.reload()">üé§ Encore! Play Again!</button>
        </div>
    </div>
    
    <script>
        // K-pop artists with photos (using placeholder service for reliability)
        const kpopArtists = [
            { 
                name: "BTS", 
                emoji: "üíú", 
                color: "#8B00FF",
                members: ["RM", "Jin", "Suga", "J-Hope", "Jimin", "V", "Jungkook"],
                photo: "https://via.placeholder.com/120/8B00FF/fff?text=BTS+üíú"
            },
            { 
                name: "BLACKPINK", 
                emoji: "üñ§üíó", 
                color: "#FF007F",
                members: ["Jisoo", "Jennie", "Ros√©", "Lisa"],
                photo: "https://via.placeholder.com/120/FF007F/fff?text=BLACKPINK"
            },
            { 
                name: "NewJeans", 
                emoji: "üê∞", 
                color: "#87CEEB",
                members: ["Minji", "Hanni", "Danielle", "Haerin", "Hyein"],
                photo: "https://via.placeholder.com/120/87CEEB/fff?text=NewJeans"
            },
            { 
                name: "Stray Kids", 
                emoji: "üñ§", 
                color: "#FF0000",
                members: ["Bang Chan", "Lee Know", "Changbin", "Hyunjin", "Han", "Felix", "Seungmin", "I.N"],
                photo: "https://via.placeholder.com/120/FF0000/fff?text=SKZ"
            },
            { 
                name: "TWICE", 
                emoji: "üç≠", 
                color: "#FF9500",
                members: ["Nayeon", "Jeongyeon", "Momo", "Sana", "Jihyo", "Mina", "Dahyun", "Chaeyoung", "Tzuyu"],
                photo: "https://via.placeholder.com/120/FF9500/fff?text=TWICE"
            },
            { 
                name: "aespa", 
                emoji: "‚ú®", 
                color: "#7B68EE",
                members: ["Karina", "Giselle", "Winter", "Ningning"],
                photo: "https://via.placeholder.com/120/7B68EE/fff?text=aespa"
            },
            { 
                name: "IVE", 
                emoji: "üíé", 
                color: "#FFD700",
                members: ["Yujin", "Gaeul", "Rei", "Wonyoung", "Liz", "Leeseo"],
                photo: "https://via.placeholder.com/120/FFD700/333?text=IVE"
            },
            { 
                name: "LE SSERAFIM", 
                emoji: "ü™Ω", 
                color: "#000080",
                members: ["Sakura", "Chaewon", "Yunjin", "Kazuha", "Eunchae"],
                photo: "https://via.placeholder.com/120/000080/fff?text=LESSERAFIM"
            },
            { 
                name: "TXT", 
                emoji: "üíô", 
                color: "#00CED1",
                members: ["Soobin", "Yeonjun", "Beomgyu", "Taehyun", "Huening Kai"],
                photo: "https://via.placeholder.com/120/00CED1/fff?text=TXT"
            },
            { 
                name: "ENHYPEN", 
                emoji: "ü¶ã", 
                color: "#FF6347",
                members: ["Jungwon", "Heeseung", "Jay", "Jake", "Sunghoon", "Sunoo", "Ni-ki"],
                photo: "https://via.placeholder.com/120/FF6347/fff?text=ENHYPEN"
            }
        ];
        
        let score = 0;
        let current = 0;
        let streak = 0;
        let maxStreak = 0;
        let questions = [];
        let selectedTopics = ['fractions', 'multiplication', 'division', 'area', 'perimeter', 'mixed'];
        
        // Create animated background elements
        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 60; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 4 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(star);
            }
        }
        
        function createFloatingElements() {
            const container = document.getElementById('floating');
            const emojis = ['üíú', 'ü©∑', '‚≠ê', '‚ú®', 'üé§', 'üéµ', 'üé∂', 'üíé', 'üåü', 'ü¶ã', 'üç≠', 'üíó'];
            
            setInterval(() => {
                const el = document.createElement('div');
                el.className = 'floating';
                el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(el);
                setTimeout(() => el.remove(), 10000);
            }, 800);
        }
        
        createStars();
        createFloatingElements();
        
        // Confetti effect
        function createConfetti() {
            const container = document.getElementById('confetti');
            const colors = ['#FF6B9D', '#C471ED', '#12C2E9', '#F7D94C', '#FF7F7F', '#7FDBCA'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    container.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 50);
            }
        }
        
        // Topic selection
        document.querySelectorAll('.topic-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('selected');
                const topic = btn.dataset.topic;
                if (selectedTopics.includes(topic)) {
                    selectedTopics = selectedTopics.filter(t => t !== topic);
                } else {
                    selectedTopics.push(topic);
                }
            });
        });
        
        function getRandomArtist() {
            return kpopArtists[Math.floor(Math.random() * kpopArtists.length)];
        }
        
        function generateFractionQuestion() {
            const artist = getRandomArtist();
            const types = ['identify', 'compare', 'equivalent'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'identify') {
                const den = [2, 3, 4, 5, 6, 8][Math.floor(Math.random() * 6)];
                const num = Math.floor(Math.random() * (den - 1)) + 1;
                const visual = Array(den).fill(false).map((_, i) => i < num);
                
                return {
                    artist,
                    topic: 'Fractions',
                    question: `${artist.name} handed out ${den} glowing lightsticks at their concert! ${num} of them are ${artist.emoji} purple. What fraction are purple?`,
                    visual: { type: 'fraction', data: visual },
                    answer: `${num}/${den}`,
                    options: generateFractionOptions(num, den),
                    hint: `Count the purple ones! ${artist.emoji}`
                };
            } else if (type === 'compare') {
                const pairs = [['1/2', '1/4'], ['1/3', '1/2'], ['2/4', '1/4'], ['3/4', '1/2'], ['2/3', '1/3']];
                const pair = pairs[Math.floor(Math.random() * pairs.length)];
                const [a, b] = Math.random() > 0.5 ? pair : [pair[1], pair[0]];
                const aVal = eval(a), bVal = eval(b);
                const answer = aVal > bVal ? '>' : aVal < bVal ? '<' : '=';
                const member1 = artist.members[0];
                const member2 = artist.members[1] || artist.members[0];
                
                return {
                    artist,
                    topic: 'Fractions',
                    question: `${member1} ate ${a} of a cake. ${member2} ate ${b} of an identical cake. Who ate MORE? (Is ${a} __ ${b}?)`,
                    visual: null,
                    answer: answer,
                    options: ['<', '>', '=', '‚â†'].sort(() => Math.random() - 0.5),
                    hint: `Which fraction is bigger? ${artist.emoji}`
                };
            } else {
                const equivs = [['1/2', '2/4'], ['1/2', '3/6'], ['2/4', '4/8'], ['1/3', '2/6'], ['2/3', '4/6']];
                const pair = equivs[Math.floor(Math.random() * equivs.length)];
                
                return {
                    artist,
                    topic: 'Fractions',
                    question: `${artist.name}'s new album is ${pair[0]} sold out! Which fraction shows the SAME amount?`,
                    visual: null,
                    answer: pair[1],
                    options: generateFractionOptions(parseInt(pair[1].split('/')[0]), parseInt(pair[1].split('/')[1])),
                    hint: `Find the equivalent fraction! ${artist.emoji}`
                };
            }
        }
        
        function generateFractionOptions(num, den) {
            const correct = `${num}/${den}`;
            const options = [correct];
            while (options.length < 4) {
                const fakeNum = Math.floor(Math.random() * 8) + 1;
                const fakeDen = [2, 3, 4, 5, 6, 8][Math.floor(Math.random() * 6)];
                const fake = `${fakeNum}/${fakeDen}`;
                if (!options.includes(fake) && fakeNum < fakeDen) options.push(fake);
            }
            return options.sort(() => Math.random() - 0.5);
        }
        
        function generateMultiplicationQuestion() {
            const artist = getRandomArtist();
            const a = Math.floor(Math.random() * 9) + 2;
            const b = Math.floor(Math.random() * 9) + 2;
            const answer = a * b;
            
            const scenarios = [
                `${artist.name} has ${a} dance studios. Each studio has ${b} mirrors. How many mirrors in TOTAL? üíÉ`,
                `${artist.members[0]} bought ${a} boxes of merch. Each box has ${b} items. How many items altogether? üì¶`,
                `There are ${a} rows of fans at the ${artist.name} concert. Each row has ${b} ARMY members. How many fans total? üé§`
            ];
            
            return {
                artist,
                topic: 'Multiplication',
                question: scenarios[Math.floor(Math.random() * scenarios.length)],
                visual: { type: 'grid', rows: Math.min(a, 6), cols: Math.min(b, 8) },
                answer: answer.toString(),
                options: generateNumberOptions(answer),
                hint: `${a} √ó ${b} = ? ${artist.emoji}`
            };
        }
        
        function generateDivisionQuestion() {
            const artist = getRandomArtist();
            const divisor = Math.floor(Math.random() * 8) + 2;
            const quotient = Math.floor(Math.random() * 10) + 1;
            const dividend = divisor * quotient;
            
            const scenarios = [
                `${artist.name} has ${dividend} concert tickets to share equally among ${divisor} fan clubs. How many tickets does each club get? üé´`,
                `${dividend} ${artist.emoji} lightsticks are divided equally among ${divisor} friends. How many does each friend get?`,
                `${artist.members[0]} has ${dividend} photo cards to give to ${divisor} lucky fans equally. How many does each fan receive? üì∏`
            ];
            
            return {
                artist,
                topic: 'Division',
                question: scenarios[Math.floor(Math.random() * scenarios.length)],
                visual: null,
                answer: quotient.toString(),
                options: generateNumberOptions(quotient),
                hint: `${dividend} √∑ ${divisor} = ? ${artist.emoji}`
            };
        }
        
        function generateAreaQuestion() {
            const artist = getRandomArtist();
            const width = Math.floor(Math.random() * 8) + 3;
            const height = Math.floor(Math.random() * 6) + 3;
            const area = width * height;
            
            const scenarios = [
                `${artist.name}'s stage is a rectangle: ${width}m wide and ${height}m long. What is the AREA of the stage? üé≠`,
                `${artist.members[0]}'s giant poster is ${width}cm by ${height}cm. What is its area? üñºÔ∏è`,
                `The ${artist.name} fan banner is ${width} feet wide and ${height} feet tall. What is the area? üìê`
            ];
            
            return {
                artist,
                topic: 'Area',
                question: scenarios[Math.floor(Math.random() * scenarios.length)],
                visual: { type: 'rectangle', width, height, showArea: true },
                answer: area.toString(),
                options: generateNumberOptions(area),
                hint: `Area = length √ó width ${artist.emoji}`
            };
        }
        
        function generatePerimeterQuestion() {
            const artist = getRandomArtist();
            const width = Math.floor(Math.random() * 8) + 3;
            const height = Math.floor(Math.random() * 6) + 3;
            const perimeter = 2 * (width + height);
            
            const scenarios = [
                `${artist.name} wants to put LED lights around their rectangular stage (${width}m √ó ${height}m). How many meters of lights? üí°`,
                `${artist.members[0]} is framing a ${width}cm √ó ${height}cm photo. How much frame is needed for all sides? üñºÔ∏è`,
                `A rectangular ${artist.name} banner is ${width}m wide and ${height}m tall. What is the PERIMETER (distance around)? üìè`
            ];
            
            return {
                artist,
                topic: 'Perimeter',
                question: scenarios[Math.floor(Math.random() * scenarios.length)],
                visual: { type: 'rectangle', width, height, showPerimeter: true },
                answer: perimeter.toString(),
                options: generateNumberOptions(perimeter),
                hint: `Perimeter = 2 √ó (length + width) ${artist.emoji}`
            };
        }
        
        function generateNumberOptions(correct) {
            const options = [correct.toString()];
            while (options.length < 4) {
                const offset = Math.floor(Math.random() * 15) - 7;
                const fake = Math.max(1, correct + offset + (options.length * (Math.random() > 0.5 ? 1 : -1)));
                if (!options.includes(fake.toString()) && fake !== correct) {
                    options.push(fake.toString());
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }
        
        function generateQuestions() {
            questions = [];
            const generators = {
                'fractions': generateFractionQuestion,
                'multiplication': generateMultiplicationQuestion,
                'division': generateDivisionQuestion,
                'area': generateAreaQuestion,
                'perimeter': generatePerimeterQuestion,
                'mixed': () => {
                    const all = [generateFractionQuestion, generateMultiplicationQuestion, generateDivisionQuestion, generateAreaQuestion, generatePerimeterQuestion];
                    return all[Math.floor(Math.random() * all.length)]();
                }
            };
            
            const topics = selectedTopics.length > 0 ? selectedTopics : ['mixed'];
            
            for (let i = 0; i < 10; i++) {
                const topic = topics[Math.floor(Math.random() * topics.length)];
                questions.push(generators[topic]());
            }
        }
        
        function renderVisual(visual) {
            const container = document.getElementById('question-visual');
            container.innerHTML = '';
            
            if (!visual) return;
            
            if (visual.type === 'fraction') {
                const div = document.createElement('div');
                div.className = 'fraction-visual';
                visual.data.forEach((filled, i) => {
                    const piece = document.createElement('div');
                    piece.className = 'fraction-piece' + (filled ? ' filled' : '');
                    piece.style.animationDelay = (i * 0.1) + 's';
                    div.appendChild(piece);
                });
                container.appendChild(div);
            }
            
            if (visual.type === 'grid') {
                const grid = document.createElement('div');
                grid.className = 'grid-visual';
                grid.style.gridTemplateColumns = `repeat(${visual.cols}, 35px)`;
                for (let i = 0; i < visual.rows * visual.cols; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell filled';
                    cell.style.animationDelay = (i * 0.03) + 's';
                    grid.appendChild(cell);
                }
                container.appendChild(grid);
            }
            
            if (visual.type === 'rectangle') {
                const wrapper = document.createElement('div');
                wrapper.className = 'shape-visual';
                const rect = document.createElement('div');
                rect.className = 'rectangle';
                rect.style.width = (visual.width * 18) + 'px';
                rect.style.height = (visual.height * 18) + 'px';
                
                const widthLabel = document.createElement('span');
                widthLabel.className = 'dimension width';
                widthLabel.textContent = visual.width + 'm';
                
                const heightLabel = document.createElement('span');
                heightLabel.className = 'dimension height';
                heightLabel.textContent = visual.height + 'm';
                
                rect.appendChild(widthLabel);
                rect.appendChild(heightLabel);
                wrapper.appendChild(rect);
                container.appendChild(wrapper);
            }
        }
        
        function startGame() {
            if (selectedTopics.length === 0) {
                selectedTopics = ['mixed'];
            }
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            generateQuestions();
            showQuestion();
        }
        
        function showQuestion() {
            const q = questions[current];
            
            document.getElementById('artist-name').textContent = q.artist.name + ' ' + q.artist.emoji;
            document.getElementById('artist-photo').src = q.artist.photo;
            document.getElementById('artist-hint').textContent = q.hint;
            document.getElementById('question-topic').textContent = q.topic;
            document.getElementById('question-type').textContent = q.topic;
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('group-emoji').textContent = q.artist.emoji;
            document.getElementById('feedback').textContent = '';
            
            renderVisual(q.visual);
            
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = q.options.map((opt, i) => 
                `<button class="answer-btn" style="animation-delay: ${i * 0.1}s" onclick="checkAnswer('${opt}', this)">${opt}</button>`
            ).join('');
        }
        
        function checkAnswer(selected, btn) {
            const q = questions[current];
            const correct = selected === q.answer;
            
            document.querySelectorAll('.answer-btn').forEach(b => b.disabled = true);
            
            if (correct) {
                btn.classList.add('correct');
                streak++;
                if (streak > maxStreak) maxStreak = streak;
                const points = 10 + (streak > 1 ? streak * 3 : 0);
                score += points;
                createConfetti();
                const cheers = [
                    'üíú PERFECT! Daebak!', 
                    '‚ú® AMAZING! You\'re a star!', 
                    'üåü INCREDIBLE! Fighting!', 
                    'üî• ON FIRE! Jjang!',
                    '‚≠ê SUPERSTAR! Saranghae!',
                    'üé§ LEGEND! You slayed!',
                    'üíé FLAWLESS! Mic drop!'
                ];
                document.getElementById('feedback').textContent = cheers[Math.floor(Math.random() * cheers.length)];
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.answer-btn').forEach(b => {
                    if (b.textContent === q.answer) b.classList.add('correct');
                });
                streak = 0;
                document.getElementById('feedback').textContent = `The answer was ${q.answer} üí™ You got this!`;
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            
            setTimeout(() => {
                current++;
                document.getElementById('current').textContent = Math.min(current + 1, 10);
                if (current < 10) {
                    showQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }
        
        function endGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-score').textContent = score;
            
            createConfetti();
            setTimeout(createConfetti, 500);
            setTimeout(createConfetti, 1000);
            
            let message = '';
            if (score >= 140) message = 'üèÜ LEGENDARY! You\'re ready for a WORLD TOUR!';
            else if (score >= 110) message = 'üåü SUPERSTAR! Main vocalist energy!';
            else if (score >= 80) message = 'üí™ GREAT JOB! You\'re debut-ready!';
            else if (score >= 50) message = 'üé§ NICE! Keep practicing, trainee!';
            else message = '‚ú® Good start! Every idol begins somewhere!';
            
            document.getElementById('final-message').textContent = message;
            
            // Show achievements
            const achievementsDiv = document.getElementById('achievements');
            achievementsDiv.innerHTML = '';
            
            const achievements = [];
            if (score >= 100) achievements.push({ emoji: 'üèÜ', label: 'High Score!' });
            if (maxStreak >= 5) achievements.push({ emoji: 'üî•', label: `${maxStreak} Streak!` });
            if (maxStreak >= 3) achievements.push({ emoji: '‚ö°', label: 'On Fire!' });
            if (selectedTopics.length >= 4) achievements.push({ emoji: 'üìö', label: 'Multi-Talented!' });
            if (score >= 140) achievements.push({ emoji: 'üëë', label: 'K-Pop Royalty!' });
            
            achievements.forEach((a, i) => {
                achievementsDiv.innerHTML += `<div class="achievement" style="animation-delay: ${i * 0.2}s"><div class="emoji">${a.emoji}</div><div class="label">${a.label}</div></div>`;
            });
        }
    </script>
</body>
</html>
